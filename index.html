<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebAssembly G11</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div><h1>Index en tarea 2</h1></div>
     
    <div>Resultado con wasm</div>
    <div id="resultado-wasm"></div>
    <div>Resultado con javascript</div>
    <div id="resultado-js"></div>
    <input type="number" id="numero" name="Ingrese un número">
    <button id="myButton">Ejecutar Función</button>
    <button id="chartReset">Resetear gráfico</button>
    <script src="factorizacion.js"></script>
    <script>
        // let resultadosWasm = [];2134567234
        // let resultadosWasm = [
        //     18.477799999982118,
        //     17.18819999998808,
        //     16.35930000001192,
        //     17.26240000000596,
        //     22.00810000002384,
        //     23.435,
        //     26.2985,
        //     32.497,
        //     17.7045,
        //     21.22640000000596,
        //     16.34359999999404,
        //     17.71330000001192, 
        //     24.05219999998808,
        //     20.76219999998808,
        //     20.00380000001192, 
        //     26.12139999997616,
        //     17.47979999998212,
        //     25.83679999998212,
        //     22.9215,
        //     26.59240000000596
        // ]; //sin
        let resultadosWasm = [
        0.3533999999761581,
         0.324,
         0.32189999997615815,
         0.3426999999880791,
         0.3381999999880791,
         0.2157000000178814,
         0.11409999999403954,
         0.17960000002384185,
         0.1935,
         0.198,
         0.248,
         0.2755,
         0.2897999999821186,
         0.3040999999940395,
         0.2895999999940395,
         0.2903000000119209,
         0.2747000000178814,
         0.28460000002384184,
         0.3082000000178814,
         0.2907000000178814
        ]
        // let resultadosJs = [
        //     19.994099999994038,
        //     17.41759999999404,
        //     17.48370000001788,
        //     16.56340000000596,
        //     17.31709999999404,
        //     16.87309999999404,
        //     21.92930000001192,
        //     16.724100000023842,
        //     18.69919999998808,
        //     21.5495,
        //     19.21819999998808,
        //     20.678199999988077,
        // ]; //o3
        let resultadosJs = [
        0.24630000001192093,
         0.23270000001788138,
         0.24059999999403953,
         0.23610000002384185,
         0.235,
         0.19990000000596048,
         0.10230000001192092,
         0.10659999999403953,
         0.10240000000596046,
         0.11139999997615814,
         0.10069999998807908,
         0.10760000002384186,
         0.107,
         0.09659999999403954,
         0.10059999999403954,
         0.1892000000178814,
         0.19290000000596047,
         0.1092000000178814,
         0.11959999999403953,
         0.0937000000178814
    ]
        // let otro = [
        // 17.578299999982118,
        // 18.15729999998212,
        // 17.94909999999404,
        // 19.64740000000596,
        // 19.852,
        // 24.24459999999404,
        // 16.88759999999404,
        // 17.77369999998808,
        // 16.39390000000596,
        // 17.766,
        // 16.7425,
        // 17.554,
        // 19.136,
        // 17.50140000000596,
        // 20.97490000000596,
        // 17.57429999998212,
        // 19.40339999997616,
        // 25.86340000000596,
        // 21.0395,
        // 17.742399999976158
        // ]
        // 345678566442
        let otro = [
        0.28240000000596044,
         0.2955,
         0.17780000001192092,
         0.11,
         0.1092999999821186,
         0.10910000002384186,
         0.09030000001192093,
         0.084,
         0.09669999998807907,
         0.10780000001192093,
         0.17759999999403953,
         0.105,
         0.12259999999403953,
         0.1455,
         0.1505,
         0.1495,
         0.1585,
         0.17359999999403952,
         0.17590000000596046,
         0.17180000001192092
        ]
        let og = [
        0.27829999998211863,
         0.09110000002384186,
         0.08789999997615815,
         0.08729999998211861,
         0.094,
         0.08880000001192093,
         0.08419999998807907,
         0.09739999997615814,
         0.10089999997615814,
         0.09559999999403954,
         0.08759999999403953,
         0.08720000001788139,
         0.1127000000178814,
         0.16309999999403954,
         0.16419999998807908,
         0.165,
         0.1497000000178814,
         0.08780000001192093,
         0.08959999999403953,
         0.204
        ]
        let os = [
        0.26609999999403955,
 0.2677999999821186,
 0.26680000001192095,
 0.2858000000119209,
 0.257,
 0.2579000000059605,
 0.18940000000596047,
 0.09640000000596047,
 0.094,
 0.08130000001192093,
 0.08309999999403954,
 0.08180000001192093,
 0.08330000001192094,
 0.13040000000596047,
 0.163,
 0.137,
 0.14270000001788138,
 0.14959999999403953,
 0.1452000000178814,
 0.14379999998211862
        ]
        let oz = [
        0.20809999999403953,
 0.20719999998807906,
 0.21959999999403954,
 0.20369999998807908,
 0.10019999998807907,
 0.06920000001788139,
 0.07609999999403953,
 0.07689999997615814,
 0.066,
 0.0755,
 0.08309999999403954,
 0.11759999999403954,
 0.11209999999403954,
 0.1307000000178814,
 0.14090000000596045,
 0.1485,
 0.14960000002384186,
 0.14540000000596046,
 0.15489999997615814,
 0.15659999999403953
        ]
        let labels = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20];
            myChart.update();
        document.getElementById('chartReset').addEventListener('click', function() {           
            resultadosWasm = [];
            resultadosWasmO2 = [];
            resultadosJs = [];
            labels = [];
            myChart.data.labels = labels;
            myChart.data.datasets[0].data = resultadosWasm;
            myChart.data.datasets[1].data = resultadosJs;
            myChart.update();
        });


        document.getElementById('myButton').addEventListener('click', factorizarWasm);
        function factorizarWasm () {
                    const numero = document.getElementById('numero').value;
                    const startWasm = performance.now();
                    const resultado_ptr = Module.ccall('factorizacionPrima', 'number', ['string'], [numero.toString()]);
                    const endWasm = performance.now();
                    const timeWasm = (endWasm - startWasm) / 1000;
                    const result = Module.UTF8ToString(resultado_ptr);
                    document.getElementById('resultado-wasm').innerText = result + '\nTiempo de ejecución: ' + timeWasm + ' segundos';
                    resultadosWasm.push(timeWasm);
                    labels.push(resultadosWasm.length);
                    myChart.update();
                };
    </script>
    <!-- <script src="./js_factorizacion.js"></script>
    <script>
        const numero = document.getElementById('numero').value;
        document.getElementById('myButton').addEventListener('click', factorizarJs);
        function factorizarJs () {
            const numero = document.getElementById('numero').value;
            const startJs = performance.now();
            const result = factorizacionPrima(numero);
            const endJs = performance.now();
            const timeJs = (endJs - startJs) / 1000;
            document.getElementById('resultado-js').innerText = result + '\nTiempo de ejecución: ' + timeJs + ' segundos';
            resultadosJs.push(timeJs);
            myChart.update();
        };
    </script> -->
    <h1>Gráfico de Resultados</h1>
    <canvas id="myChart" width="400" height="200"></canvas>
    <script>
        const ctx = document.getElementById('myChart').getContext('2d');
        const myChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: labels,
                datasets: [{
                    label: 'Wasm',
                    data: resultadosWasm,
                    fill: false,
                    borderColor: 'rgb(255, 99, 132)',
                    tension: 0.1
                }, {
                    label: 'Wasm O2',
                    data: resultadosJs,
                    fill: false,
                    borderColor: 'rgb(165, 146, 162)',
                    tension: 0.1
                }, {
                    label: 'Wasm O3',
                    data: otro,
                    fill: false,
                    borderColor: 'rgb(75, 192, 192)',
                    tension: 0.1
                }, {
                    label: 'Wasm Og',
                    data: og,
                    fill: false,
                    borderColor: 'rgb(163, 121, 162)',
                    tension: 0.1
                }, {
                    label: 'Wasm Os',
                    data: os,
                    fill: false,
                    borderColor: 'rgb(200, 156, 112)',
                    tension: 0.1
                }, {
                    label: 'Wasm Oz',
                    data: oz,
                    fill: false,
                    borderColor: 'rgb(120, 182, 206)',
                    tension: 0.1
                }]
                // }, {
                //     label: 'Javascript',
                //     data: resultadosJs,
                //     fill: false,
                //     borderColor: 'rgb(75, 192, 192)',
                //     tension: 0.1
                // }]
            },
            options: {
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });
    </script>    
</body>
</html>